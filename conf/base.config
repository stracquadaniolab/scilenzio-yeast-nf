// basic information about the workflow
manifest {
  name = 'scilenzio-yeast-nf'
  description = 'Analysis of transcriptional repression in synthetic yeast chromosome using RNA-seq data.'
  version = '0.2.1'
  homePage = 'https://github.com/stracquadaniolab/scilenzio-yeast-nf.git'
  author = 'Anima Sutradhar'
  nextflowVersion = '>=20.07.1'
}

// default configuration
executor {
	name = 'local'
	cpus   = 4
	memory = 8.GB
  queueSize = 5
}

process {
	executor = 'local'
	cpus = 2
	memory = 4.GB
	shell = ['/bin/bash', '-euo', 'pipefail']
}

// Export this variable to prevent local Python libraries
// from conflicting with those in the container
env {
  PYTHONNOUSERSITE = 1
}

// profiles to setup runtimes, executors, and process resources
profiles {

    docker {
        docker.enabled         = true
        docker.userEmulation   = true
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false

        process.container = "ghcr.io/stracquadaniolab/scilenzio-yeast-nf:0.2.1"
    }

    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        docker.enabled         = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false

        process.container = "docker://ghcr.io/stracquadaniolab/scilenzio-yeast-nf:0.2.1"
    }

    slurm {
        process.executor='slurm'
        process.queue='compute'
    }

    apple {
      docker.runOptions = '--platform linux/amd64'
    }    

    ci {
        executor.name = 'local'
        executor.cpus   = 2
        executor.memory = 6.GB
        executor.queueSize = 5

        process.executor = 'local'
        process.cpus = 1
        process.memory = 2.GB
        process.shell = ['/bin/bash', '-euo', 'pipefail']
    }

    // profile containing dummy data to test the workflow
    test {
        params {

          // general
          resultsDir = "./results/"
          samplesheet = "testdata/metadata/samplesheet.csv"
          reads = "testdata/reads"
          
          // source genome files
          reference_wt = "data/genome/BY4742-genome/BY4742.fasta"
          annotation_wt = "data/genome/BY4742-genome/BY4742.gff"
          reference_syn = "data/genome/syn-yeast-genome/contigs/yeast_chr11_3_39.ref.fasta"
          annotation_syn = "data/genome/syn-yeast-genome/annotation/yeast_chr11_3_39.ref.gff"

          // combined genome files
          genome.reference = "data/genome/wt-syn-genome/wt-syn-chr11-ref.fasta"
          genome.annotation = "data/genome/wt-syn-genome/wt-syn-chr11-ref.gff"

          // fastp parameters
          fastp.args = ""

          // STAR parameters
          star.sjdbOverhang = "100"
          star.genomeSAindexNbases = "14"
          star.alignIntronMax = "0"
          star.limitBAMsortRAM = "0"
          star.outBAMsortingBinsN = "50"

          // salmon parameters
          salmon.index.args = "--keepDuplicates"
          salmon.quant.libtype = "A"
          salmon.quant.args = "--writeUnmappedNames"

          // tximport parameters
          summarize_to_gene.counts_from_abundance = "no"
          summarize_to_gene.quant_dir = "results/salmon-quant"
          summarize_to_gene.annotation = "results/wt-syn-transcriptome/wt-syn-transcriptome.gff"

          // deseq2 parameters
          dge.lfc_threshold = ""
          dge.fdr = ""

        }
    }

}

// configuring log information
report {
    enabled = true
    file = "logs/execution_report.html"
}